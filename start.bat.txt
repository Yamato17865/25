@echo off
chcp 65001
title –¢—Ä–∞–∫—Å–Ø–∫—É—Ç–∏—è –°–µ—Ä–≤–µ—Ä

echo ========================================
echo   üöõ –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê –î–õ–Ø –¢–ï–õ–ï–§–û–ù–ê
echo ========================================

REM 1. –£–±–∏–≤–∞–µ–º —Å—Ç–∞—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python
taskkill /F /IM python.exe /IM pythonw.exe 2>nul

REM 2. –ü–æ–ª—É—á–∞–µ–º IP
for /f "tokens=2 delims=:" %%i in ('ipconfig ^| findstr /C:"IPv4"') do set IP=%%i
set IP=%IP:~1%
echo üì± –í–∞—à IP: %IP%

REM 3. –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ—Ä—Ç
netsh advfirewall firewall add rule name="TraksYakutia" dir=in action=allow protocol=TCP localport=8000 2>nul

REM 4. –°–æ–∑–¥–∞–µ–º Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞
echo import socket > server_all.py
echo import sys >> server_all.py
echo from http.server import HTTPServer, SimpleHTTPRequestHandler >> server_all.py
echo. >> server_all.py
echo class Handler(SimpleHTTPRequestHandler): >> server_all.py
echo     def __init__(self, *args, **kwargs): >> server_all.py
echo         super().__init__(*args, directory=".", **kwargs) >> server_all.py
echo. >> server_all.py
echo if __name__ == "__main__": >> server_all.py
echo     port = 8000 >> server_all.py
echo     server_address = ('0.0.0.0', port) >> server_all.py
echo     httpd = HTTPServer(server_address, Handler) >> server_all.py
echo     print(f"Server at http://0.0.0.0:{port}") >> server_all.py
echo     print(f"For phone: http://%IP%:{port}") >> server_all.py
echo     try: >> server_all.py
echo         httpd.serve_forever() >> server_all.py
echo     except KeyboardInterrupt: >> server_all.py
echo         print("\nServer stopped") >> server_all.py

REM 5. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
echo.
echo ‚úÖ –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä...
echo.
python server_all.py